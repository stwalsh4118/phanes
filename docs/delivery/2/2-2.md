# 2-2 Create runner package

[Back to task list](./tasks.md)

## Description

Create a runner package (`internal/runner/runner.go`) that manages a module registry and executes modules in order with proper error handling and idempotency checks.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-01-27 00:00:00 | Created | N/A | Proposed | Task file created | sean |

## Requirements

1. Package located at `internal/runner/runner.go`
2. `Runner` struct with module registry (map[string]Module)
3. Methods:
   - `RegisterModule(module Module)` - Add module to registry
   - `RunModules(names []string, cfg *config.Config, dryRun bool) error` - Execute modules by name
4. Runner should:
   - Check `IsInstalled()` before running `Install()`
   - Skip modules that are already installed (log skip message)
   - Handle errors gracefully
   - Continue or stop based on error severity
   - Support dry-run mode
5. Use logging package for output

## Implementation Plan

1. Create `internal/runner/` directory
2. Create `runner.go` with package declaration
3. Import `internal/module`, `internal/config`, `internal/log`
4. Define `Runner` struct:
   - `modules map[string]Module`
   - `dryRun bool`
5. Implement `NewRunner()` constructor
6. Implement `RegisterModule()`:
   - Add module to map using `Name()` as key
   - Handle duplicate registration
7. Implement `RunModules()`:
   - Iterate through module names
   - Look up module in registry
   - If dry-run, log what would happen
   - Otherwise:
     - Check `IsInstalled()`
     - If installed, log skip and continue
     - If not installed, call `Install()`
     - Handle errors (log and return or continue based on severity)
8. Add error types for different failure modes
9. Add basic unit tests

## Verification

1. Modules can be registered
2. Runner executes modules in order
3. Runner skips already-installed modules
4. Runner handles errors correctly
5. Dry-run mode shows actions without executing
6. Unit tests pass

## Files Modified

- `internal/runner/runner.go` (new)
- `internal/runner/runner_test.go` (new)

