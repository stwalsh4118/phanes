# 2-3 Create profile package

[Back to task list](./tasks.md)

## Description

Create a profile package (`internal/profile/profile.go`) that defines server profiles as lists of module names and provides lookup functionality.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-01-27 00:00:00 | Created | N/A | Proposed | Task file created | sean |
| 2025-01-27 00:00:00 | Status Update | Proposed | InProgress | Started implementation | sean |
| 2025-01-27 00:00:00 | Status Update | InProgress | Review | Implementation complete, all tests passing | sean |
| 2025-01-27 00:00:00 | Status Update | Review | Done | Task approved and completed | sean |

## Requirements

1. Package located at `internal/profile/profile.go`
2. Define profiles map:
   - `minimal`: baseline, user, security, swap, updates
   - `dev`: baseline, user, security, swap, updates, docker, monitoring, devtools
   - `web`: baseline, user, security, swap, updates, docker, monitoring, caddy
   - `database`: baseline, user, security, swap, updates, docker, monitoring, postgres, redis
   - `coolify`: baseline, user, security, swap, updates, docker, coolify
3. Functions:
   - `GetProfile(name string) ([]string, error)` - Get module list for profile
   - `ListProfiles() []string` - List all available profile names
   - `ProfileExists(name string) bool` - Check if profile exists

## Implementation Plan

1. Create `internal/profile/` directory
2. Create `profile.go` with package declaration
3. Define `profiles` map as package-level variable:
   ```go
   var profiles = map[string][]string{
       "minimal": {...},
       "dev": {...},
       ...
   }
   ```
4. Implement `GetProfile()`:
   - Look up profile in map
   - Return module list or error if not found
5. Implement `ListProfiles()`:
   - Extract keys from map
   - Return sorted list
6. Implement `ProfileExists()`:
   - Check if key exists in map
7. Add godoc comments
8. Add basic unit tests

## Verification

1. `GetProfile()` returns correct module list for valid profiles
2. `GetProfile()` returns error for invalid profiles
3. `ListProfiles()` returns all profile names
4. `ProfileExists()` correctly identifies existing/non-existing profiles
5. Unit tests pass

## Files Modified

- `internal/profile/profile.go` (new) - Created profile package with profiles map and all required functions
- `internal/profile/profile_test.go` (new) - Comprehensive unit tests covering all functions and edge cases
- `docs/api-specs/infrastructure/infrastructure-api.md` (updated) - Added profile package API documentation

## Implementation Notes

### Implementation Details

1. **Profile package structure**:
   - Created `internal/profile/profile.go` with profiles map and three public functions
   - Profiles map defined as package-level variable with all five required profiles
   - All functions follow Go best practices with proper error handling

2. **Key design decisions**:
   - `GetProfile()` returns a copy of the module list to prevent external modification
   - `ListProfiles()` returns sorted profile names for consistent output
   - `ProfileExists()` provides a simple boolean check for profile existence
   - Error messages are clear and descriptive

3. **Testing approach**:
   - Created comprehensive unit tests for all functions
   - Tests cover: all profiles, non-existent profiles, empty strings, case sensitivity
   - Added test to verify `GetProfile()` returns a copy (not reference)
   - Added test to verify all profiles are valid and retrievable
   - Tests verify `ListProfiles()` returns sorted results

### Code Quality

- ✅ `go fmt` - Code is properly formatted
- ✅ `go vet` - No static analysis issues
- ✅ All unit tests pass (5 test functions, 15+ test cases)
- ✅ Proper error handling (no panics)
- ✅ Follows Go best practices
- ✅ Comprehensive godoc comments

### Verification Results

1. ✅ `GetProfile()` returns correct module list for all valid profiles
2. ✅ `GetProfile()` returns error for invalid profiles
3. ✅ `GetProfile()` returns a copy (not reference) of module list
4. ✅ `ListProfiles()` returns all profile names in sorted order
5. ✅ `ProfileExists()` correctly identifies existing/non-existing profiles
6. ✅ All unit tests pass
7. ✅ Case sensitivity is handled correctly

