# 11-2 Implement Tailscale Module

[Back to task list](./tasks.md)

## Description

Create `internal/modules/tailscale/tailscale.go` implementing the Module interface to install and configure Tailscale VPN.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-01-27 00:00:00 | Created | N/A | Proposed | Task file created | sean |

## Requirements

1. Create `internal/modules/tailscale/tailscale.go` file
2. Implement `TailscaleModule` struct with Module interface:
   - `Name()` returns "tailscale"
   - `Description()` returns "Installs and configures Tailscale VPN"
   - `IsInstalled()` checks:
     - `tailscale` command exists
     - `tailscale status` shows connected state
     - `tailscaled` systemd service is enabled
   - `Install(cfg)`:
     - Skip if Tailscale not enabled in config
     - Download and run official install script: `curl -fsSL https://tailscale.com/install.sh | sh`
     - Authenticate: `tailscale up --authkey=<key>`
     - Enable systemd service: `systemctl enable --now tailscaled`
     - Display Tailscale status/IP after installation
3. Support dry-run mode
4. Implement idempotency checks
5. Add appropriate error handling and logging

## Implementation Plan

1. Create `internal/modules/tailscale/` directory
2. Create `tailscale.go` file with package declaration
3. Import required packages (config, exec, log, module)
4. Define constants for Tailscale install script URL and service name
5. Implement helper functions:
   - `tailscaleInstalled()` - Check if tailscale command exists
   - `tailscaleConnected()` - Check if Tailscale is authenticated/connected
   - `tailscaleServiceEnabled()` - Check if systemd service is enabled
6. Implement `TailscaleModule` struct
7. Implement `Name()` method
8. Implement `Description()` method
9. Implement `IsInstalled()` method using helper functions
10. Implement `Install()` method with:
    - Config validation (check if enabled)
    - Auth key validation
    - Installation steps with dry-run support
    - Service configuration
    - Status display
11. Add interface compliance check: `var _ module.Module = (*TailscaleModule)(nil)`

## Verification

1. Module compiles without errors
2. Module implements Module interface correctly
3. `IsInstalled()` correctly detects installation state
4. `Install()` correctly installs and configures Tailscale
5. Module is idempotent (safe to run multiple times)
6. Dry-run mode works correctly
7. Error handling is appropriate

## Files Modified

- `internal/modules/tailscale/tailscale.go` (new) - Tailscale module implementation

