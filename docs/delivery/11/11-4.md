# 11-4 E2E CoS Test

[Back to task list](./tasks.md)

## Description

Verify all acceptance criteria from the PBI 11 PRD work correctly in both normal and dry-run modes.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-01-27 00:00:00 | Created | N/A | Proposed | Task file created | sean |

## Requirements

Verify all acceptance criteria from PBI 11 PRD:

1. Module installs Tailscale via official install script
2. Module authenticates using provided auth key from config
3. `IsInstalled()` correctly detects if Tailscale is already configured and authenticated
4. Module is idempotent (safe to run multiple times)
5. Config struct includes tailscale section with `enabled` and `auth_key` fields
6. Module validates auth key format
7. Tailscale service is enabled and started on boot
8. Module displays Tailscale status after installation
9. Works in both normal and dry-run modes

## Implementation Plan

1. Create integration test file `test/integration/tailscale_test.go` (if appropriate)
2. Test scenarios:
   - Test module installation with valid auth key
   - Test module skips when Tailscale is disabled in config
   - Test `IsInstalled()` detects existing installation
   - Test idempotency (run install twice, second time should skip)
   - Test auth key validation (reject invalid format)
   - Test service is enabled and started
   - Test status display after installation
   - Test dry-run mode produces correct output
3. Manual verification:
   - Run phanes with Tailscale module enabled and valid auth key
   - Verify Tailscale is installed and authenticated
   - Verify service is running and enabled
   - Run phanes again to verify idempotency
   - Test with invalid auth key format
   - Test dry-run mode

## Verification

1. All test scenarios pass
2. All acceptance criteria are verified
3. Module works correctly in both normal and dry-run modes
4. Manual testing confirms all functionality

## Files Modified

- `test/integration/tailscale_test.go` (new, if appropriate) - E2E tests for Tailscale module

