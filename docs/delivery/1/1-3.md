# 1-3 Create config package

[Back to task list](./tasks.md)

## Description

Create a config package (`internal/config/config.go`) that defines the configuration structure, loads YAML files, and validates configuration. The config should support all module settings with sensible defaults.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-01-27 00:00:00 | Created | N/A | Proposed | Task file created | sean |

## Requirements

1. Package located at `internal/config/config.go`
2. Define `Config` struct with YAML tags for all settings:
   - User settings (username, SSH key, timezone)
   - Swap configuration
   - Security settings
   - Docker settings
   - Postgres settings
   - Redis settings
   - Web server settings
   - Dev tools settings
   - Coolify settings
3. Function `Load(path string) (*Config, error)` - Load and parse YAML file
4. Function `Validate(cfg *Config) error` - Validate required fields
5. Provide sensible defaults for optional fields
6. Use `gopkg.in/yaml.v3` for YAML parsing

## Implementation Plan

1. Create `internal/config/` directory
2. Create `config.go` with package declaration
3. Define `Config` struct with nested structs for organization:
   - `User` struct (username, ssh_public_key)
   - `System` struct (timezone)
   - `Swap` struct (enabled, size)
   - `Security` struct (ssh_port, allow_password_auth)
   - `Docker` struct (install_compose)
   - `Postgres` struct (version, password)
   - `Redis` struct (password)
   - `Nginx` struct (enabled)
   - `Caddy` struct (enabled)
   - `DevTools` struct (node_version, python_version, go_version)
   - `Coolify` struct (enabled)
4. Implement `Load()`:
   - Read file with `os.ReadFile`
   - Unmarshal YAML with `yaml.Unmarshal`
   - Apply defaults
   - Validate
   - Return config and error
5. Implement `Validate()`:
   - Check required fields (username, ssh_public_key)
   - Return descriptive errors
6. Add `DefaultConfig()` helper for defaults
7. Add basic unit tests

## Verification

1. `Load()` correctly parses valid YAML files
2. `Load()` applies defaults for missing fields
3. `Validate()` catches missing required fields
4. `Validate()` returns clear error messages
5. Unit tests pass

## Files Modified

- `internal/config/config.go` (new)
- `internal/config/config_test.go` (new)
- `go.mod` (add gopkg.in/yaml.v3 dependency)

