# 8-4 Implement module selection parsing

[Back to task list](./tasks.md)

## Description

Parse comma-separated module list from `--modules` flag, validate module names exist in registry, and handle errors gracefully. This enables users to select specific modules to run.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-01-27 00:00:00 | Created | N/A | Proposed | Task file created | sean |
| 2025-01-27 23:40:00 | Status Update | Proposed | InProgress | Started implementation | sean |
| 2025-01-27 23:40:00 | Status Update | InProgress | Review | Implementation complete, all tests passing | sean |
| 2025-01-27 23:45:00 | Status Update | Review | Done | Task approved and completed | sean |

## Requirements

1. Parse comma-separated string from `--modules` Cobra flag
2. Split by comma and trim whitespace
3. Validate each module name exists (will need access to module registry or runner)
4. Handle empty/invalid module names
5. Return list of validated module names
6. Log selected modules
7. Handle duplicate module names (deduplicate)

## Implementation Plan

1. Create `parseModuleList(moduleStr string) ([]string, error)` function in `main.go`
2. Split string by comma: `strings.Split(moduleStr, ",")`
3. Trim whitespace from each module name: `strings.TrimSpace()`
4. Filter out empty strings
5. Deduplicate module names (use map or check for duplicates)
6. Validate module names exist:
   - Need to check against module registry
   - For now, can defer validation to runner (runner will handle unknown modules)
   - OR: Create helper to get available modules from runner
7. Log info message showing selected modules
8. Return module list
9. Call `parseModuleList()` from `runCommand()` when `--modules` Cobra flag is set

## Verification

1. Comma-separated module list parses correctly
2. Whitespace is trimmed from module names
3. Empty strings are filtered out
4. Duplicate modules are removed
5. Module list is logged correctly
6. Empty module list is handled gracefully

## Test Plan

1. **Valid modules**: Test with "baseline,user,security", verify parsing
2. **Whitespace**: Test with "baseline , user , security", verify trimming
3. **Duplicates**: Test with "baseline,baseline,user", verify deduplication
4. **Empty strings**: Test with "baseline,,user", verify empty filtered
5. **Single module**: Test with "baseline", verify works
6. **Empty flag**: Test with empty string, verify handled

## Files Modified

- `main.go` (updated) - Added `parseModuleList()` function and integrated module parsing into `runCommand()`

## Implementation Notes

### Implementation Details

1. **Module parsing function**:
   - Created `parseModuleList(moduleStr string) ([]string, error)` function in `main.go`
   - Splits comma-separated string using `strings.Split()`
   - Trims whitespace from each module name using `strings.TrimSpace()`
   - Filters out empty strings
   - Deduplicates module names using a map to track seen modules
   - Returns error if no valid modules found after filtering

2. **Error handling**:
   - Empty string returns error: "empty module list"
   - String with only whitespace/commas returns error: "no valid modules found in module list"
   - Errors are wrapped and returned to caller

3. **Integration**:
   - `parseModuleList()` is called from `runCommand()` when `--modules` flag is set
   - Parsed modules are stored in `selectedModules` variable for later use in subsequent tasks
   - Module list is logged using `log.Info()` showing selected modules

4. **Validation strategy**:
   - Basic parsing validation (empty strings, whitespace) is done in `parseModuleList()`
   - Actual module name validation against the registry is deferred to the runner (task 8-6)
   - This approach allows parsing to work before modules are registered

### Code Quality

- ✅ `go build` - Code compiles successfully
- ✅ `go vet` - No static analysis issues
- ✅ No linter errors
- ✅ Proper error handling (no panics)
- ✅ Clear error messages
- ✅ Follows Go best practices

### Verification Results

1. ✅ Comma-separated module list parses correctly ("baseline,user,security")
2. ✅ Whitespace is trimmed from module names ("baseline , user , security" → "baseline, user, security")
3. ✅ Empty strings are filtered out ("baseline,,user" → "baseline, user")
4. ✅ Duplicate modules are removed ("baseline,baseline,user" → "baseline, user")
5. ✅ Module list is logged correctly
6. ✅ Empty module list is handled gracefully (returns error)

### Test Results

All test scenarios pass:
- **Valid modules**: "baseline,user,security" → parsed correctly, logged as "baseline, user, security"
- **Whitespace**: "baseline , user , security" → trimmed correctly, logged as "baseline, user, security"
- **Duplicates**: "baseline,baseline,user" → deduplicated to "baseline, user"
- **Empty strings**: "baseline,,user" → filtered to "baseline, user"
- **Single module**: "baseline" → works correctly, logged as "baseline"
- **Empty/whitespace-only**: "  ,  ,  " → returns error "no valid modules found in module list"

