# 8-2 Implement config file loading

[Back to task list](./tasks.md)

## Description

Implement configuration file loading with default path handling (`config.yaml`), validation, and error handling. This integrates the config package with the CLI.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-01-27 00:00:00 | Created | N/A | Proposed | Task file created | sean |

## Requirements

1. Load config file using path from `--config` Cobra flag (default: "config.yaml")
2. Use `config.Load()` function from `internal/config` package
3. Handle file not found errors gracefully
4. Handle validation errors with clear messages
5. Return config or error to caller
6. Log errors using `log.Error()`
7. If config file doesn't exist, use default config (via `config.DefaultConfig()`)

## Implementation Plan

1. Create `loadConfig(path string) (*config.Config, error)` function in `main.go`
2. Check if file exists using `exec.FileExists()` or `os.Stat()`
3. If file doesn't exist:
   - Log info message that default config will be used
   - Return `config.DefaultConfig()` (but still need to validate required fields)
   - OR: Return error if config file is required
4. If file exists:
   - Call `config.Load(path)`
   - Handle errors:
     - File read errors: return with clear message
     - YAML parse errors: return with clear message
     - Validation errors: return with clear message
5. Log success message when config loads
6. Call `loadConfig()` from `runCommand()` when needed (not in list mode)

## Verification

1. Config loads successfully from valid YAML file
2. Config validation errors are caught and reported clearly
3. Missing config file is handled appropriately (default or error)
4. Invalid YAML is caught and reported clearly
5. Required fields are validated
6. Success message is logged when config loads

## Test Plan

1. **Valid config**: Create test config.yaml, verify loads correctly
2. **Missing file**: Test with non-existent file, verify default or error
3. **Invalid YAML**: Test with malformed YAML, verify error message
4. **Missing required fields**: Test config missing username/ssh_public_key, verify validation error
5. **Default values**: Verify defaults are applied for optional fields

## Files Modified

- `main.go` (updated)

