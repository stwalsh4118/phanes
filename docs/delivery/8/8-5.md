# 8-5 Implement --list flag functionality

[Back to task list](./tasks.md)

## Description

Implement the `--list` flag to display available modules and profiles in a user-friendly format. This helps users discover what's available without reading documentation.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-01-27 00:00:00 | Created | N/A | Proposed | Task file created | sean |
| 2025-01-27 00:56:00 | Status Update | Proposed | InProgress | Started implementation | sean |
| 2025-01-27 00:56:00 | Status Update | InProgress | Review | Implementation complete, all tests passing | sean |
| 2025-01-27 01:00:00 | Status Update | Review | Done | Task approved and completed | sean |

## Requirements

1. When `--list` Cobra flag is set, display:
   - Available profiles (from `profile.ListProfiles()`)
   - For each profile, show its modules
   - Available modules (from runner/module registry)
   - For each module, show its description
2. Format output clearly with headers and sections
3. Use logging package for output (Info/Success)
4. Exit after listing (don't proceed with execution)
5. Make output readable and well-formatted

## Implementation Plan

1. Create `listProfilesAndModules()` function in `main.go`
2. Get profiles:
   - Call `profile.ListProfiles()` to get all profile names
   - For each profile, call `profile.GetProfile()` to get modules
   - Format and display
3. Get modules:
   - Need access to module registry from runner
   - For each module, get name and description
   - Format and display
4. Format output:
   ```
   Available Profiles:
   - minimal: baseline, user, security, swap, updates
   - dev: baseline, user, security, swap, updates, docker, monitoring, devtools
   ...
   
   Available Modules:
   - baseline: Sets timezone, locale, and runs apt update
   - user: Creates user and sets up SSH keys
   ...
   ```
5. Call `listProfilesAndModules()` from `runCommand()` when `--list` Cobra flag is set
6. Exit after listing (return early from main)

## Verification

1. `--list` Cobra flag displays all profiles
2. Each profile shows its modules
3. All modules are listed with descriptions
4. Output is well-formatted and readable
5. Program exits after listing (doesn't try to execute)

## Test Plan

1. **List profiles**: Run with `--list`, verify all profiles shown
2. **Profile modules**: Verify each profile shows correct modules
3. **List modules**: Verify all modules listed with descriptions
4. **Formatting**: Verify output is readable and well-formatted
5. **Exit behavior**: Verify program exits after listing

## Files Modified

- `main.go` (updated) - Added `registerAllModules()` and `listProfilesAndModules()` functions, integrated --list flag handling

## Implementation Notes

### Implementation Details

1. **Module Registration**:
   - Created `registerAllModules()` helper function that creates a runner instance and registers all available modules
   - Currently registers `baseline` and `user` modules
   - Function is designed to be reusable for module execution (task 8-6)
   - Note: As more modules are implemented, they should be added to this function

2. **List Functionality**:
   - Created `listProfilesAndModules()` function that displays:
     - All available profiles with their module lists (sorted alphabetically)
     - All registered modules with their descriptions (sorted alphabetically)
   - Uses `profile.ListProfiles()` and `profile.GetProfile()` for profile information
   - Uses runner's `ListModules()` and `GetModule()` for module information
   - Formats output with clear headers and indentation for readability
   - Adds blank line between profiles and modules sections

3. **Integration**:
   - Updated `runCommand()` to call `listProfilesAndModules()` when `--list` flag is set
   - Function returns early (nil) after listing, preventing execution
   - Added necessary imports: `sort`, `runner`, `modules/baseline`, `modules/user`

### Code Quality

- ✅ `go build` - Code compiles successfully
- ✅ No linter errors
- ✅ Proper error handling
- ✅ Follows Go best practices
- ✅ Output is well-formatted and readable

### Verification Results

1. ✅ `--list` flag displays all profiles (coolify, database, dev, minimal, web)
2. ✅ Each profile shows its modules correctly
3. ✅ All registered modules are listed with descriptions (baseline, user)
4. ✅ Output is well-formatted with headers, indentation, and blank line between sections
5. ✅ Program exits after listing (doesn't try to execute, even when other flags are present)

